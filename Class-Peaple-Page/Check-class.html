<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á</title>
    <link rel="stylesheet" href="CodeCSS/nav-bar.css">
    <link rel="icon" href="photo-Class/favicon-logo.png" type="image/png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <link rel="stylesheet" href="CodeCSS/check-class.css">
    <style>
        .bg {
          background: url('photo-Class/Res-background.jpg')no-repeat center center/cover;
          filter: blur(1px) brightness(110%);
        }
    </style>
</head>
<body>
    <div class="bg"></div>

    <!--nav-bar-->
    <nav>
        <div class="navlogo">
            <img src="photo-Class/favicon-logo.png" alt="icon-image" class="nav-logo-img">
            <div class="nav-logo">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á</div>
        </div>

        <div class="menu-icon" id="menu-icon">
            <span class="material-symbols-outlined hamberger-icon">dehaze</span>
        </div>

        <div class="nav-link" id="nav-link">
            <a href="leader-password.html">
                <span class="material-symbols-outlined nav-icon food">lock_person</span>‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            </a>
            <a href="Check-class.html" class="nav-link-active">
                <span class="material-symbols-outlined nav-icon">browse_gallery</span>‡∏ï‡∏£‡∏ß‡∏à‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            </a>
            <a href="" id="NameUser" class="no-after">
                <span class="material-symbols-outlined nav-icon">account_box</span>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            </a>
        </div>
    </nav>

	<!--header-->
	<div class="inline-head-for-check">
		<div class="green-for-check">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á</div><div class="yellow-for-check">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ</div>
	</div>

  <div class="timecurrent" id="timecurrent"></div>
  
  <div class="container-dropdown">
    <label for="dropdownBtn">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ :</label>
    <div class="custom-dropdown">
      <button id="dropdownBtn"></button>
      <div class="dropdown-content">
        <div class="option" data-value="building-1">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 1</div>
        <div class="divider"></div>
        <div class="option" data-value="building-2">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 2</div>
        <div class="divider"></div>
        <div class="option" data-value="building-3">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 3</div>
        <div class="divider"></div>
        <div class="option" data-value="building-4">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 4</div>
        <div class="divider"></div>
        <div class="option" data-value="building-5">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 5</div>
        <div class="divider"></div>
        <div class="option" data-value="building-multipurpose">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡πÄ‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</div>
      </div>
    </div>
  </div>



    <!-- ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ï‡πà‡∏≤‡∏á‡πÜ -->
    <section class="building">
        <h2>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 1</h2>
        <div id="building-1" class="rooms"></div>
    </section>

    <section class="building">
        <h2>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 2</h2>
        <div id="building-2" class="rooms"></div>
    </section>

    <section class="building">
        <h2>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 3</h2>
        <div id="building-3" class="rooms"></div>
    </section>

    <section class="building">
      <h2>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 4</h2>
      <div id="building-4" class="rooms"></div>
    </section>

    <section class="building">
      <h2>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 5</h2>
      <div id="building-5" class="rooms"></div>
    </section>

    <section class="building">
        <h2>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡πÄ‡∏ô‡∏Å‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</h2>
        <div id="building-multipurpose" class="rooms"></div>
    </section>
    

    <!--alert-box-->
	<div id="alertBox" class="custom-alert">
		<img id="alertIcon" src="" alt="alertIcon" class="alert-icon">
		<span id="alertMessage" class="alertMessage"></span>
		<button id="alertOkBtn">OK</button>
    <button id="backbutton"><a href="index.html">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Login</a></button>
	</div>


    <script type="module" src="CodeJS/building-data.js"></script>

    <script type="module">
      import { buildings } from "./CodeJS/building-data.js";
      import { manualRooms } from "./CodeJS/building-data.js";
      import { getAllManualStatuses } from "./CodeJS/room-manager.js";

      async function checkRoom(buildingId, roomName, autoScheduleStatus) {
        const roomId = buildingId + "_" + roomName;
      
        const manual = await getRoomStatus(roomId);
      
        // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÇ‡∏´‡∏°‡∏î manual ‚Üí ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
        if (manual && manual.mode === "manual") {
          return {
            status: manual.status,
            source: "manual",
            untilTime: manual.untilTime || null
          };
        }
      
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ manual ‚Üí ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Auto ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ
        return {
          status: autoScheduleStatus,
          source: "auto"
        };
      }

      document.getElementById('menu-icon').onclick = function() {
			  document.getElementById('nav-link').classList.toggle('active');
		  }

        /*‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏±‡∏á‡∏ä‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö*/
		  const form = document.querySelector('form');
		  const nameUser = document.getElementById('NameUser');

        /*‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏ä‡πà‡∏ô reload ‡∏´‡∏ô‡πâ‡∏≤) ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á*/
      window.addEventListener('load', function() {
			  const savedEmailNumber = localStorage.getItem('email');
			  if (savedEmailNumber) {
				  nameUser.innerHTML = `<span class="material-symbols-outlined">account_box</span>${savedEmailNumber}`;
			  } else {
				  nameUser.innerHTML = `
					  <span class="material-symbols-outlined">account_box</span>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
				  `;
			  }
		  });
		
		
		  /*‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏ß‡πâ*/
		  nameUser.addEventListener("click", function(e) {
		  	e.preventDefault();
		  	const savedName = localStorage.getItem('username') || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ";
		  	const savedEmail = localStorage.getItem('email') || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•";
		  	showAlert(`‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ : ${savedName}\n ‡∏≠‡∏µ‡πÄ‡∏°‡∏• : ${savedEmail}`, "success");
		  });
		
		
		
		  function showAlert(message, type="success", redirecURL=null) {
		  	const alertBox = document.getElementById('alertBox');
		  	const alertMessage = document.getElementById('alertMessage');
		  	const alertBtn = document.getElementById('alertOkBtn');
		  	const alertIcon = document.getElementById('alertIcon');
        const backbutton = document.getElementById('backbutton');
      
		  	alertMessage.textContent = message;
      
		  	if (type === "error") {
		  		alertIcon.src = "https://cdn-icons-png.flaticon.com/512/1828/1828843.png";
		  		alertBox.className = "custom-alert show error"
		  	} else {
		  		alertIcon.src = "https://cdn-icons-png.flaticon.com/512/845/845646.png";
		  		alertBox.className = "custom-alert show"
          backbutton.className = "show"
		  	}
			
		  	alertBtn.onclick = () => {
		  		alertBox.classList.remove('show');

		  		if (redirecURL) {
		  			window.location.href = redirecURL;
		  		}
		  	}
		  }
      
      
      // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
      function getSecondsSinceMidnight() {
        const now = new Date();
        return now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
      }
      
      // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏ô‡∏≤‡∏ó‡∏µ/‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
      function formatCountdown(seconds) {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = seconds % 60;
        return `${h > 0 ?  h.toString().padStart(2, '0') + " ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á" : ""} ${m > 0 ? m.toString().padStart(2, '0') + " ‡∏ô‡∏≤‡∏ó‡∏µ" : ""} ${s.toString().padStart(2, '0')} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
      }
      
      // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å

      let manualStatuses = {};

      async function updateAllBuildings() {
        const now = new Date();

        const days = ["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏û‡∏∏‡∏ò", "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡πÄ‡∏™‡∏≤‡∏£‡πå"];
        const today = days[now.getDay()];
        const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();

        for (const [buildingId, rooms] of Object.entries(buildings)) {
          const container = document.getElementById(buildingId);
          const fragment = document.createDocumentFragment(); // *** ‡πÄ‡∏û‡∏¥‡πà‡∏° Fragment ***

          for (const [roomName, times] of Object.entries(rooms)) {
            const roomId = roomName.replace(/\s/g, '');
            const manual = manualStatuses[roomId];

            let status = "‡∏ß‡πà‡∏≤‡∏á";
            let className = "free";
            let countdownText = "";
            let currentClass = "";
            let currentSubject = "";
            let nextClass = "";
            let nextSubject = "";
            let countdownSeconds = 0;

            if (manual && manual.mode === "manual") {
              status = manual.status;
              className = status === "‡∏ß‡πà‡∏≤‡∏á" ? "free manual" : "busy manual";

              const [hh, mm] = manual.untilTime.split(":").map(Number);
              const expireSec = hh * 3600 + mm * 60;

              if (expireSec > nowSec) {
                countdownSeconds = expireSec - nowSec;
                countdownText = `‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Auto ‡πÉ‡∏ô ${formatCountdown(countdownSeconds)}`;
              } else {
                // Manual ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß
                status = "‡∏ß‡πà‡∏≤‡∏á";
                className = "free manual expired";
                countdownText = "Manual ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß (‡∏£‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Auto)";
              }
            } else {
              let soonestStartSec = null;
              let isBusy = false;

              for (const t of times) {
                if (t.day !== today && t.day !== "‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô") continue;

                const [sh, sm] = t.start.split(":").map(Number);
                const [eh, em] = t.end.split(":").map(Number);
                const startSec = sh * 3600 + sm * 60;
                const endSec = eh * 3600 + em * 60;

                if (nowSec >= startSec && nowSec < endSec) {
                  isBusy = true;
                  status = "‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á";
                  className = "busy auto";
                  countdownSeconds = endSec - nowSec;
                  countdownText = `‡∏à‡∏∞‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏µ‡∏Å‡πÉ‡∏ô ${formatCountdown(countdownSeconds)}`;
                  currentClass = t.class;
                  currentSubject = t.subject;
                  break;
                } else if (nowSec < startSec) {
                  if (!soonestStartSec || startSec < soonestStartSec) {
                    soonestStartSec = startSec;
                    nextClass = t.class;
                    nextSubject = t.subject;
                  }
                }
              }

              if (!isBusy && soonestStartSec) {
                status = "‡∏ß‡πà‡∏≤‡∏á";
                className = "free auto";
                countdownSeconds = soonestStartSec - nowSec;
                countdownText = `‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å ${formatCountdown(countdownSeconds)}`;
              } else if (!isBusy && !soonestStartSec) {
                status = "‡∏ß‡πà‡∏≤‡∏á";
                className = "free auto full-day";
                countdownText = "‡∏ß‡πà‡∏≤‡∏á‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ";
              }
            }

            const div = document.createElement("div");
            div.className = `room ${className}`;
            div.setAttribute('data-countdown-sec', countdownSeconds);
            div.setAttribute('data-room-id', roomId);

            div.innerHTML = `
              <h3>${roomName} <span class="badge ${manual && manual.mode === 'manual' ? 'manual' : 'auto'}">${manual && manual.mode === 'manual' ? 'Manual' : 'Auto'}</span></h3>
              <p class="status-text">${status}</p>
              ${currentClass ? `<p class="detail">‡∏ä‡∏±‡πâ‡∏ô: ${currentClass}</p><p class="detail">‡∏ß‡∏¥‡∏ä‡∏≤: ${currentSubject}</p>` : ""}
              ${!currentClass && nextClass ? `<p class="detail">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ${nextClass}</p><p class="detail">‡∏ß‡∏¥‡∏ä‡∏≤: ${nextSubject}</p>` : ""}
              <p class="countdown-timer">${countdownText}</p>
            `;

            fragment.appendChild(div);
          }
          container.innerHTML = "";
          container.appendChild(fragment);
        }
      }

      let lastFetchTime = 0;
      const FETCH_INTERVAL = 30000;

      async function fetchAndUpdateManualStatus() {
        const now = new Date();

        if (now.getTime() - lastFetchTime > FETCH_INTERVAL || lastFetchTime === 0) {
          console.log('Fetching new manual statuses from Firebase...');
          manualStatuses = await getAllManualStatuses(); // üö® ‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≠‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
          lastFetchTime = now.getTime();

          // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Manual ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
          updateAllBuildings();
        }
      }

      function startTimerCountdown() {
        addtimecurrent();

        document.querySelectorAll('.room').forEach(roomDiv => {
          let seconds = parseInt(roomDiv.getAttribute('data-countdown-sec'), 10);

          if (seconds > 0) {
            seconds -= 1;
            roomDiv.setAttribute('data-countdown-sec', seconds);

            const timerP = roomDiv.querySelector('.countdown-timer');
            if (timerP) {
              const isManual = roomDiv.classList.contains('manual');
              const isBusy = roomDiv.classList.contains('busy');

              let prefix = isManual ? '‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Auto ‡πÉ‡∏ô' : (isBusy ? '‡∏à‡∏∞‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏µ‡∏Å‡πÉ‡∏ô' : '‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å');

              timerP.textContent = `${prefix} ${formatCountdown(seconds)}`;
            }
          } else if (seconds === 0) {
            roomDiv.setAttribute('data-countdown-sec', -1);
          }
        });
      }

      window.addEventListener('DOMContentLoaded', () => {
        updateAllBuildings();

        fetchAndUpdateManualStatus(); // ‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏î‡∏∂‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à

        setInterval(startTimerCountdown, 1000); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç Timer ‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setInterval(updateAllBuildings, 30000); // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
      });


      
    /*
      function updateAllBuildings() {
        const days = ["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏û‡∏∏‡∏ò", "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡πÄ‡∏™‡∏≤‡∏£‡πå"];
        const today = days[new Date().getDay()];
        const now = getSecondsSinceMidnight();
      
        for (const [buildingId, rooms] of Object.entries(buildings)) {
          const container = document.getElementById(buildingId);
          container.innerHTML = "";
        
          for (const [roomName, times] of Object.entries(rooms)) {
            let status = "‡∏ß‡πà‡∏≤‡∏á";
            let className = "free";
            let countdown = "";
            let currentClass = "";
            let currentSubject = "";
            let nextClass = "";
            let nextSubject = "";
            let soonestStart = null;
          
            for (const t of times) {
              if (t.day !== today && t.day !== "‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô") continue;
            
              const [sh, sm] = t.start.split(":").map(Number);
              const [eh, em] = t.end.split(":").map(Number);
              const startSec = sh * 3600 + sm * 60;
              const endSec = eh * 3600 + em * 60;
            
              if (now >= startSec && now < endSec) {
                status = "‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á";
                className = "busy";
                countdown = `‡∏à‡∏∞‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏µ‡∏Å‡πÉ‡∏ô ${formatCountdown(endSec - now)}`;
                currentClass = t.class;
                currentSubject = t.subject;
                break;
              } else if (now < startSec) {
                if (!soonestStart || startSec < soonestStart.startSec) {
                  soonestStart = { ...t, startSec };
                }
              }
            } 
          
            if (status === "‡∏ß‡πà‡∏≤‡∏á" && soonestStart) {
              countdown = `‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å ${formatCountdown(soonestStart.startSec - now)}`;
              nextClass = soonestStart.class;
              nextSubject = soonestStart.subject;
            }
          
            const div = document.createElement("div");
            div.className = `room ${className}`;
            div.innerHTML = `
              <h3>${roomName}</h3>
              <p>${status}</p>
              ${currentClass ? `<p>‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ${currentClass}</p><p>‡∏ß‡∏¥‡∏ä‡∏≤: ${currentSubject}</p>` : ""}
              ${!currentClass && nextClass ? `<p>‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ${nextClass}</p><p>‡∏ß‡∏¥‡∏ä‡∏≤: ${nextSubject}</p>` : ""}
              <p>${countdown}</p>
            `;
            container.appendChild(div);
          }
        }
      } */
      
      //updateAllBuildings();
      //setInterval(updateAllBuildings, 1000);

      function addtimecurrent() {
        const time = document.getElementById('timecurrent');
        const days = ["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏û‡∏∏‡∏ò", "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡πÄ‡∏™‡∏≤‡∏£‡πå"];
        const today = days[new Date().getDay()];
        const seconds = getSecondsSinceMidnight();
        const months = [
          "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
          "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
        ];

        const now = new Date();

        const date = now.getDate();
        const month = months[now.getMonth()];
        const year = now.getFullYear() + 543;
        const h = now.getHours().toString().padStart(2, '0');
        const m = now.getMinutes().toString().padStart(2, '0');
        const s = now.getSeconds().toString().padStart(2, '0');

        time.innerHTML = `
          <h2>‡∏ß‡∏±‡∏ô${today} ‡∏ó‡∏µ‡πà ${date} ${month} ‡∏û.‡∏®.${year} ‡πÄ‡∏ß‡∏•‡∏≤ ${h} : ${m} : ${s}</h2>
        `
      }

      addtimecurrent();
      setInterval(addtimecurrent, 1000);

      const dropdownBtn = document.getElementById('dropdownBtn');
      const dropdownContent = document.querySelector('.dropdown-content');
      const options = document.querySelectorAll('.dropdown-content .option');

      dropdownBtn.addEventListener('click', () => {
        dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
      });

      options.forEach(option => {
        option.addEventListener('click', () => {
          const value = option.getAttribute('data-value');
          dropdownBtn.textContent = option.textContent; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£
          dropdownContent.style.display = 'none';
          showSelectedBuildingCustom(value);
        });
      });

      function showSelectedBuildingCustom(selected) {
        const allBuildings = document.querySelectorAll('.building');
        allBuildings.forEach(section => {
          if (section.querySelector(`#${selected}`)) {
            section.style.display = 'block';
          } else {
            section.style.display = 'none';
          }
        });
      }

      // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å

      window.addEventListener('load', () => {
        dropdownBtn.textContent = "‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 1"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î
        showSelectedBuildingCustom('building-1'); // ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 1
      });



    </script>
</body>
</html>