<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โรงเรียนพัทลุง</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
    <link rel="stylesheet" href="CodeCSS/update-room.css">
</head>
<body>

    <h2 id="roomName"></h2>

    <label>สถานะห้อง:</label>
    <select id="status">
      <option value="busy">ไม่ว่าง</option>
      <option value="free">ว่าง</option>
      <option value="teacher-late">ครูมาสาย</option>
      <option value="student-using">มีนักเรียนใช้</option>
    </select>

    <label>หมดคาบ :</label>
    <select id="period">
      <option value="0">คาบ 0 (07:40 - 08:30)</option>
      <option value="1">คาบ 1 (08:30 - 09:20)</option>
      <option value="2">คาบ 2 (09:20 - 10:10)</option>
      <option value="3">คาบ 3 (10:10 - 11:00)</option>
      <option value="4">คาบ 4 (11:00 - 11:50)</option>
      <option value="5">คาบ 5 (11:50 - 12:40)</option>
      <option value="6">คาบ 6 (12:40 - 13:30)</option>
      <option value="7">คาบ 7 (13:30 - 14:20)</option>
      <option value="8">คาบ 8 (14:20 - 15:10)</option>
      <option value="9">คาบ 9 (15:10 - 16:00)</option>
    </select>

    <button id="saveBtn">บันทึก</button>
    <button id="resetBtn" style="background:#555; color:white; margin-top:10px;">
        กลับสู่โหมดอัตโนมัติ
    </button>


<script type="module">
    import { setRoomManual, resetRoomToAuto } from "./CodeJS/room-manager.js";
    
    const resetBtn = document.getElementById("resetBtn");
    const saveBtn = document.getElementById("saveBtn");
    const status = document.getElementById("status");
    const period = document.getElementById("period");
    
    const params = new URLSearchParams(location.search);
    const roomId = params.get("room");
    

    document.getElementById("roomName").innerText = "แก้ไขห้อง " + roomId;
    
    // เวลา “หมดคาบ”
    const periodEndTimes = {
      0: "08:30",
      1: "09:20",
      2: "10:10",
      3: "11:00",
      4: "11:50",
      5: "12:40",
      6: "13:30",
      7: "14:20",
      8: "15:10",
      9: "16:00"
    };
    
    // ✔ บันทึกโหมด manual
    saveBtn.onclick = async () => {
      if (!period.value) {
        alert("กรุณาเลือกคาบก่อน");
        return;
      }
    
      const untilTime = periodEndTimes[period.value]; // ได้ HH:MM เช่น "11:00"
    
      await setRoomManual(
        roomId,
        status.value,
        untilTime
      );
    
      alert("บันทึกแล้ว!");
      location.href = "select-room.html";
    };
    
    // ✔ ปุ่มกลับ auto mode
    resetBtn.onclick = async () => {
      if (!confirm("ต้องการกลับไปใช้โหมดอัตโนมัติหรือไม่?")) return;
    
      await resetRoomToAuto(roomId);
      alert("เปลี่ยนกลับเป็นโหมดอัตโนมัติแล้ว");
      location.href = "select-room.html";
    };
</script>

</body>

</html>