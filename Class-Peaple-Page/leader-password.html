<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โรงเรียนพัทลุง</title>
    <link rel="icon" href="favicon-logo.png" type="image/png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
    <link rel="stylesheet" href="CodeCSS/nav-bar.css">
    <link rel="stylesheet" href="CodeCSS/leader-password.css">
</head>
<body>
    <div class="bg"></div>
    <!--nav-bar-->
    <nav>
        <div class="navlogo">
            <img src="photo-Class/favicon-logo.png" alt="icon-image" class="nav-logo-img">
            <div class="nav-logo">โรงเรียนพัทลุง</div>
        </div>

        <div class="menu-icon" id="menu-icon">
            <span class="material-symbols-outlined hamberger-icon">dehaze</span>
        </div>

        <div class="nav-link" id="nav-link">
            <a href="leader-password.html" class="nav-link-active">
                <span class="material-symbols-outlined nav-icon food">lock_person</span>หัวหน้าห้องเรียน
            </a>
            <a href="Check-class.html">
                <span class="material-symbols-outlined nav-icon">browse_gallery</span>ตรวจห้องเรียน
            </a>
            <a href="" id="NameUser" class="no-after">
                <span class="material-symbols-outlined nav-icon">account_box</span>ชื่อผู้ใช้
            </a>
        </div>
    </nav>

    <div class="login-content-wrapper">
        <div class="login-card-container">
            <h1>เข้าสู่ระบบหัวหน้าห้อง</h1>
            <input type="email" id="email" placeholder="อีเมลหัวหน้าห้อง">
            <input type="password" id="password" placeholder="รหัสผ่าน">
            <button id="loginBtn">เข้าสู่ระบบ</button>
        </div>
    </div>

      <!--alert-box-->
	<div id="alertBox" class="custom-alert">
		<img id="alertIcon" src="" alt="alertIcon" class="alert-icon">
		<span id="alertMessage" class="alertMessage"></span>
		<button id="alertOkBtn">OK</button>
    <button id="backbutton"><a href="index.html">กลับหน้า Login</a></button>
	</div>


</body>

<script type="module">
    import { auth } from "./CodeJS/firebase.js";
    import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    document.getElementById('menu-icon').onclick = function() {
		document.getElementById('nav-link').classList.toggle('active');
	}
		
		
	/*ส่วนฟังชันเข้าสู่ระบบ*/
	const form = document.querySelector('form');
	const nameUser = document.getElementById('NameUser');

    /*ถ้ามีข้อมูลอยู่แล้ว (เช่น reload หน้า) ให้ดึงกลับมาแสดง*/
    window.addEventListener('load', function() {
		const savedEmailNumber = localStorage.getItem('email');
		if (savedEmailNumber) {
			 nameUser.innerHTML = `<span class="material-symbols-outlined">account_box</span>${savedEmailNumber}`;
		} else {
		    nameUser.innerHTML = `
				<span class="material-symbols-outlined">account_box</span>ชื่อผู้ใช้
			`;
		}
	});

    /*เมื่อกดที่ชื่อผู้ใช้ ให้แสดงข้อมูลที่กรอกไว้*/
	nameUser.addEventListener("click", function(e) {
		e.preventDefault();
		const savedName = localStorage.getItem('username') || "ไม่พบชื่อผู้ใช้";
		const savedEmail = localStorage.getItem('email') || "ไม่พบอีเมล";
		showAlert(`ชื่อผู้ใช้ : ${savedName}\n อีเมล : ${savedEmail}`, "success");
	});

    function showAlert(message, type="success", redirecURL=null) {
		const alertBox = document.getElementById('alertBox');
		const alertMessage = document.getElementById('alertMessage');
		const alertBtn = document.getElementById('alertOkBtn');
		const alertIcon = document.getElementById('alertIcon');
        const backbutton = document.getElementById('backbutton');
      
		alertMessage.textContent = message;
      
		if (type === "error") {
			alertIcon.src = "https://cdn-icons-png.flaticon.com/512/1828/1828843.png";
			alertBox.className = "custom-alert show error"
		} else {
		  	alertIcon.src = "https://cdn-icons-png.flaticon.com/512/845/845646.png";
		  	alertBox.className = "custom-alert show"
            backbutton.className = "show"
		}
			
		alertBtn.onclick = () => {
			alertBox.classList.remove('show');

		  	if (redirecURL) {
		  		window.location.href = redirecURL;
		  	}
		}
	}

    // ดึงปุ่ม login
    const btn = document.getElementById("loginBtn");

    btn.addEventListener("click", async () => {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        try {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            // เข้าสู่ระบบสำเร็จ → ไปหน้า update.html
            location.href = "select-room.html";
        } catch (error) {
            alert("อีเมลหรือรหัสผ่านไม่ถูกต้อง: " + error.message);
        }
    });
</script>
</html>